# 02_Raytracing_01

## 项目简介
这是光线追踪系列的第二阶段首个示例程序，标志着几何体系统的重大升级。本版本在保留材质系统的基础上，首次引入了三角形几何体，实现了球体和三角形的混合场景渲染，为构建更复杂的3D场景奠定了基础。

## 核心突破
- **三角形几何体支持**：首次实现显式几何体渲染
- **混合场景**：同时支持隐式几何体(球体)和显式几何体(三角形)
- **平面表示**：使用两个三角形组成地面平面，替代之前的大球体方案
- **场景重构**：优化的四球布局，呈现"三点一线"的视觉效果
- **渲染品质提升**：更自然的光照分布和材质表现

## 几何系统升级
```cpp
// 球体系统（延续前版本）
RayTracerShader.setFloat("sphere[0].radius", 0.5);
RayTracerShader.setVec3("sphere[0].center", glm::vec3(0.0, 0.0, -1.0));
RayTracerShader.setInt("sphere[0].materialIndex", 0); // 漫反射
RayTracerShader.setVec3("sphere[0].albedo", glm::vec3(0.8, 0.7, 0.2));

// 新增三角形系统（地面平面）
RayTracerShader.setVec3("tri[0].v0", glm::vec3(2.0, -0.5, 2.0));
RayTracerShader.setVec3("tri[0].v1", glm::vec3(-2.0, -0.5, -2.0));
RayTracerShader.setVec3("tri[0].v2", glm::vec3(-2.0, -0.5, 2.0));

RayTracerShader.setVec3("tri[1].v0", glm::vec3(2.0, -0.5, 2.0));
RayTracerShader.setVec3("tri[1].v1", glm::vec3(-2.0, -0.5, -2.0));
RayTracerShader.setVec3("tri[1].v2", glm::vec3(2.0, -0.5, -2.0));
```

## 场景布局
本版本采用了更有美感的场景布局：
- **中心球体**：黄色漫反射球，位于场景中心
- **左右两侧球体**：蓝色和绿色金属球，分布在中心球体两侧
- **顶部球体**：红色金属球，位于中心球体正上方
- **地面平面**：由两个三角形组成的平面，替代过去使用的超大半径球体

## 几何交点算法
本版本实现了两种关键的光线相交算法：
1. **光线-球体相交**：通过解析几何方程计算交点
2. **光线-三角形相交**：使用Möller–Trumbore算法实现
   - 光线方程：p(t) = o + td
   - 三角形重心坐标：p = (1-u-v)v0 + uv1 + vv2
   - 求解参数t、u、v确定交点位置

## 渲染优势对比
| 特性 | 01_Raytracing_05 | 02_Raytracing_01 |
|------|------------------|-----------------|
| 几何类型 | 仅球体(隐式几何) | 球体+三角形(混合几何) |
| 地面表示 | 超大半径球体 | 两个三角形组成的平面 |
| 场景布局 | 水平线性排列 | "三点一线"立体构图 |
| 相交算法 | 单一算法 | 多种几何相交算法 |
| 扩展性 | 有限 | 可构建任意复杂模型 |

## 技术实现
- **三角形相交检测**：在着色器中实现Möller–Trumbore算法
- **材质系统复用**：与前版本一致的材质体系
- **随机种子优化**：修改为874264.0f，提供不同的随机模式
- **渲染管线保持**：延续双缓冲的渐进式渲染框架


![image-20250519200032370](./assets/image-20250519200032370.png)
